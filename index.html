<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <link rel="stylesheet" href="shoppingList.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCK_TujHizuO3etGZqzuO2Bpk4Ei4zLF00",
            authDomain: "jaredshoppinglist.firebaseapp.com",
            projectId: "jaredshoppinglist",
            storageBucket: "jaredshoppinglist.appspot.com",
            messagingSenderId: "86072516707",
            appId: "1:86072516707:web:d2a9b7a2fd550f79c81856"
        };

        // Initialize Firebase
        var firebaseApp = initializeApp(firebaseConfig);
        var firebaseDb = getFirestore(firebaseApp);
        var newMealIngredientCount = 0;

        $(document).ready(function () {
            async function getAllMeals(db) {
                const citiesCol = collection(db, 'meals');
                const citySnapshot = await getDocs(citiesCol);
                const cityList = citySnapshot.docs.map(doc => doc.data());
                //console.log(cityList);
                return cityList;
            }

            async function getMeal(db, mealName) {
                const docRef = doc(db, "meals", mealName);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    //console.log("Document data:", docSnap.data());
                    return await docSnap.data();
                } else {
                    // doc.data() will be undefined in this case
                    //console.log("No such document!");
                    return null;
                }
            }

            $("#weeklyPlanningNav").click(function () {
                $("#DisplayWeeks").show();
                $("#DisplayMeals").hide();
                $("#DisplayRecipes").hide();
                $("#DisplayGroceryList").hide();
                $("#DisplayAddMeal").hide();
            });

            $("#mealNav").click(function () {
                $("#DisplayWeeks").hide();
                $("#DisplayMeals").show();
                $("#DisplayRecipes").hide();
                $("#DisplayGroceryList").hide();
                $("#DisplayAddMeal").hide();

                getAllMeals(firebaseDb, name).then((value) => {                                     
                    $("#mealList").empty();                    
                    $.each(value, function (i, item) {
                        $("#mealList").append('<span class="mealListItem">' + item.name + "</span> <br />");
                    });
                });
            });

            $(".mealListItem").click(function () {
                $("#DisplayWeeks").hide();
                $("#DisplayMeals").hide();
                $("#DisplayRecipes").show();
                $("#DisplayGroceryList").hide();
                $("#DisplayAddMeal").hide();

                var name = $(this).text();
                /** Link up to firebase to pull this info, grab it by name **/
                //Can delete this test instance                
                getMeal(firebaseDb, name).then((value) => {
                    console.log(value);
                    $("#selectedMealName").text(value.name);
                    $("#ingredientsList").empty();
                    console.log(value.ingredients);
                    $.each(value.ingredients, function (i, item) {
                        $("#ingredientsList").append(item.amount + " " + item.name + "<br />");
                    });
                });
            });

            $("#groceryListNav").click(function () {
                $("#DisplayWeeks").hide();
                $("#DisplayMeals").hide();
                $("#DisplayRecipes").hide();
                $("#DisplayGroceryList").show();
                $("#DisplayAddMeal").hide();
            });

            $("#addMealNav").click(function () {
                $("#DisplayWeeks").hide();
                $("#DisplayMeals").hide();
                $("#DisplayRecipes").hide();
                $("#DisplayGroceryList").hide();
                $("#DisplayAddMeal").show();
            });
        });

        $("#addAdditionalIngredient").click(function () {
            $("#newIngredientList").append('<div id="newIngredientDiv' + newMealIngredientCount + '" data-rowCount="' + newMealIngredientCount + '"> ' +
                '<input type="text" id="newIngredientAmount' + newMealIngredientCount + '" name="newIngredientAmount' + newMealIngredientCount + '" placeholder="Amount" required> ' +
                '<input type="text" id="newIngredientName' + newMealIngredientCount + '" name="newIngredientName' + newMealIngredientCount + '" placeholder="Ingredient Name" required> ' +
                '<input type="text" id="newIngredientCategory' + newMealIngredientCount + '" name="newIngredientCategory' + newMealIngredientCount + '" placeholder="Category" required> ' +
                '<button id="newIngredientRemove' + newMealIngredientCount + '">Remove</button>' + 
                '</div>');

            $("#newIngredientRemove" + newMealIngredientCount).click(function () {
                var row = $(this).attr('id').substring(19);                
                $("#newIngredientDiv" + row).remove();
            });

            newMealIngredientCount++;
        });

        $("#week1Toggle").click(function () {

        });
    </script>    
</head>





<body>
    <div>
        <span id="weeklyPlanningNav">Weekly Planning</span> | <span id="groceryListNav">View Grocery List</span> | <span id="mealNav">View Meals</span> | <span id="addMealNav">Add Meal</span>
    </div>
    <hr />

    <div id="DisplayWeeks" class="show">
        <h1>Weekly Planning</h1>
        <div id="week1Meals">
            <div><h2>WEEK 1</h2> <button id="week1Toggle">Toggle</button></div>
            <span>Monday</span>
        </div>
        <div id="week2Meals">
            <h2>WEEK 2</h2> <button id="week2Toggle">Toggle</button>
        </div>
        <div id="week3Meals">
            <h2>WEEK 3</h2> <button id="week3Toggle">Toggle</button>
        </div>
        <div id="week4Meals">
            <h2>WEEK 4</h2> <button id="week4Toggle">Toggle</button>
        </div>
    </div>
    <div id="DisplayGroceryList" class="hide">

    </div>
    <div id="DisplayMeals" class="hide">
        <h1>Meal List</h1>
        <div id="mealList">
            loading..
        </div>
        <button id="addMeal">Add Meal</button>
    </div>
    <div id="DisplayRecipes" class="hide">
        <h1>Meal Recipe</h1>
        <strong>Meal Name:</strong> <span id="selectedMealName"></span>
        <h2>Ingredients</h2>
        <div id="ingredientsList">

        </div>
    </div>
    <div id="DisplayAddMeal" class="hide">
        <h1>Add Meal</h1>
        <strong><label for="newMealName">Meal Name:</label></strong>
        <input type="text" id="newMealName" name="newMealName" required>
        <br />
        <br />
        <strong>Ingredients</strong>
        <div id="newIngredientList">
            <div>
                <input type="text" id="newIngredientAmount" name="newIngredientAmount" placeholder="Amount" required>
                <input type="text" id="newIngredientName" name="newIngredientName" placeholder="Ingredient Name" required>
                <input type="text" id="newIngredientCategory" name="newIngredientCategory" placeholder="Category" required>
            </div>
        </div>
        <br />       
        <button id="addAdditionalIngredient">Add New Ingredient</button>
        <br />
        <br />
        <button id="addMeal">Add Meal</button>
    </div>
</body>
</html>